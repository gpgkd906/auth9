runner:
  shell: "/bin/zsh"
  shell_arg: "-lc"

resume:
  auto: true

defaults:
  workspace: "auth9"
  workflow: "qa_fix_retest"

workspaces:
  auth9:
    root_path: "../.."
    qa_targets:
      - "docs/qa"
      - "docs/security"
    ticket_dir: "docs/ticket"

agents:
  opencode:
    templates:
      init_once: "echo \"qa-orchestrator init_once\""
      qa: "opencode run \"读取文档：{rel_path}，执行QA测试\" -m \"deepseek/deepseek-chat\""
      retest: "opencode run \"读取文档：{rel_path}，执行QA测试\" -m \"deepseek/deepseek-chat\""
      loop_guard: "if [ \"{unresolved_items}\" -eq 0 ]; then echo stop; else echo continue; fi"
  claudecode:
    templates:
      fix: "claude -p --dangerously-skip-permissions --verbose --model opus --output-format stream-json \"/ticket-fix {ticket_paths}\""

workflows:
  qa_only:
    steps:
      - id: "init_once"
        type: "init_once"
        enabled: false
      - id: "qa"
        type: "qa"
        enabled: true
        agent_id: "opencode"
      - id: "fix"
        type: "fix"
        enabled: false
      - id: "retest"
        type: "retest"
        enabled: false
    loop:
      mode: "once"
      guard:
        enabled: true
        stop_when_no_unresolved: true
        agent_id: null
  qa_fix:
    steps:
      - id: "init_once"
        type: "init_once"
        enabled: false
      - id: "qa"
        type: "qa"
        enabled: true
        agent_id: "opencode"
      - id: "fix"
        type: "fix"
        enabled: true
        agent_id: "claudecode"
      - id: "retest"
        type: "retest"
        enabled: false
    loop:
      mode: "once"
      guard:
        enabled: true
        stop_when_no_unresolved: true
        agent_id: null
  only-fix:
    steps:
      - id: "init_once"
        type: "init_once"
        enabled: false
      - id: "qa"
        type: "qa"
        enabled: false
      - id: "fix"
        type: "fix"
        enabled: true
        agent_id: "claudecode"
      - id: "retest"
        type: "retest"
        enabled: false
    loop:
      mode: "once"
      guard:
        enabled: true
        stop_when_no_unresolved: true
        agent_id: null
  qa_fix_retest:
    steps:
      - id: "init_once"
        type: "init_once"
        enabled: false
      - id: "qa"
        type: "qa"
        enabled: true
        agent_id: "opencode"
      - id: "fix"
        type: "fix"
        enabled: true
        agent_id: "claudecode"
      - id: "retest"
        type: "retest"
        enabled: true
        agent_id: "opencode"
    loop:
      mode: "once"
      guard:
        enabled: true
        stop_when_no_unresolved: true
        agent_id: null
