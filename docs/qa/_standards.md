# QA 文档规范（qa-doc-gen-v1）

本文件定义 `docs/qa` 的统一治理规则，所有新增或修改 QA 文档必须遵循。

## 1. 场景数量

1. 每个文档最多 5 个编号场景（`## 场景 N`）。
2. 超过 5 个场景必须拆分为多个文档，保持单文档执行粒度。

## 2. UI 可见性与入口规则

1. 只要文档包含 Portal UI 流程，必须包含一个“入口可见性”场景（建议作为场景 1）。
2. Portal UI 主流程必须从用户可见入口开始（侧边栏、Tab、Quick Links、按钮、菜单）。
3. 禁止将“直接输入 URL”作为主流程起点。
4. URL 直达仅允许用于负向验证（如鉴权重定向、CSRF、兼容重定向），且必须在场景目的或标题中明确“负向验证/回归验证”。

## 3. 通用认证状态测试

1. 禁止使用“关闭浏览器即未登录”作为默认前提。
2. 认证失效测试应使用以下任一方式：
   - 无痕/隐私窗口；
   - 手动清除 `auth9_session` cookie；
   - 显式点击「Sign out」。
3. 若保留认证通用场景，需给出上述可执行说明。

## 4. 文档结构

1. 每篇文档必须包含“检查清单”（`## 检查清单` 或 `## 回归测试检查清单`）。
2. 涉及数据变更的场景应包含“预期数据状态”与 SQL 验证。
3. UI 操作描述优先使用中文按钮名（如「创建」「保存」）。

## 5. 索引与统计

1. `docs/qa/_manifest.yaml` 是 QA 文档清单的事实来源。
2. `docs/qa/README.md` 的索引与统计必须与 manifest 一致。
3. 新增文档必须同步更新 manifest 与 README。

## 6. 自动校验

`scripts/qa-doc-lint.sh` 负责执行以下校验：

1. README 索引覆盖率。
2. 场景数上限（<= 5）。
3. 检查清单存在性。
4. Portal UI 文档的入口可见性规则。
5. 认证通用场景的可执行性关键字。
