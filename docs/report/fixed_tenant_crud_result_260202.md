# 租户管理 QA 测试报告

**测试日期**: 2026-02-02
**测试人员**: Claude (自动化测试)
**测试环境**: localhost (Docker Compose)
**测试账号**: admin / Admin123!

---

## 测试范围

- `docs/qa/tenant/01-crud.md` - CRUD 操作测试
- `docs/qa/tenant/02-list-settings.md` - 列表与设置测试（部分）

---

## 01-crud.md 测试结果

### 场景 1：创建租户 ✓ 通过

**操作步骤**:
1. 点击「租户管理」菜单
2. 点击「Create Tenant」按钮
3. 填写表单：
   - 租户名称：`测试公司`
   - Slug：`test-company`
   - Logo URL：`https://example.com/logo.png`
4. 点击「Create」按钮

**实际结果**:
- 创建成功，无错误提示
- 租户出现在列表中，状态为「active」
- 列表计数更新为 2 tenants

**状态**: ✓ 通过

---

### 场景 2：创建重复 Slug 的租户 ✓ 通过

**操作步骤**:
1. 点击「Create Tenant」
2. 填写 Slug：`test-company`（已存在）
3. 点击「Create」

**实际结果**:
- 显示错误提示：「Tenant with slug 'test-company' already exists」
- 租户未被创建
- 列表仍为 2 tenants

**状态**: ✓ 通过

---

### 场景 3：更新租户信息 ✓ 通过

**操作步骤**:
1. 找到「测试公司」，点击菜单 → 「Edit」
2. 修改：
   - 名称：`测试公司（更新）`
   - Logo URL：`https://example.com/new-logo.png`
3. 点击「Save Changes」

**实际结果**:
- 更新成功
- 列表中显示新名称「测试公司（更新）」
- 更新时间已更新

**状态**: ✓ 通过

---

### 场景 4：删除无关联数据的租户 ⚠️ 差异

**操作步骤**:
1. 找到「测试公司（更新）」
2. 点击菜单 → 「Delete」
3. 确认删除对话框点击「确定」

**预期结果**:
- 租户从列表中消失

**实际结果**:
- 租户状态变为「inactive」
- 租户仍显示在列表中
- 列表计数仍为 2 tenants

**状态**: ⚠️ 行为差异（软删除 vs 物理删除）

**备注**: 系统采用软删除策略，将租户状态设为 inactive 而非物理删除。如果这是预期行为，建议更新 QA 文档。

---

### 场景 5：删除有关联数据的租户（级联删除）

**状态**: ⏭️ 未测试

**原因**: 测试环境中没有带关联数据（用户、服务、Webhook、邀请）的租户

---

## 02-list-settings.md 测试结果

### 场景 1：租户列表分页

**状态**: ⏭️ 未测试

**原因**: 测试环境中租户数量不足 25 条，无法验证分页

---

### 场景 2：查看租户详情

**状态**: ⏭️ 未测试

---

### 场景 3：搜索租户

**状态**: ⏭️ 未测试

---

### 场景 4：租户设置更新

**状态**: ⏭️ 未测试

---

### 场景 5：Slug 格式验证 ✓ 通过

**测试用例**:

| 输入 | 预期 | 实际 | 状态 |
|------|------|------|------|
| `TestCompany` (大写) | 拒绝 | `invalid_slug` 错误 | ✓ |
| `test@company` (特殊字符) | 拒绝 | `invalid_slug` 错误 | ✓ |
| `-test-company` (连字符开头) | 拒绝 | `invalid_slug` 错误 | ✓ |
| 超过 63 字符 | 拒绝 | `length` 错误 (min:1, max:63) | ✓ |

**状态**: ✓ 通过

---

## 测试汇总

| 文档 | 场景 | 通过 | 失败 | 差异 | 未测 |
|------|------|------|------|------|------|
| 01-crud.md | 5 | 3 | 0 | 1 | 1 |
| 02-list-settings.md | 5 | 1 | 0 | 0 | 4 |
| **合计** | **10** | **4** | **0** | **1** | **5** |

---

## 发现的问题

### 1. 删除行为与预期不一致 (中)

**描述**: 删除租户操作实际为软删除（状态变为 inactive），与 QA 文档描述的"租户从列表消失"不一致。

**建议**:
- 如果软删除是预期行为，更新 QA 文档描述
- 如果需要物理删除，调整后端逻辑
- 考虑添加筛选功能，可选择只显示 active 租户

### 2. 错误消息格式不友好 (低)

**描述**: Slug 验证错误显示原始 JSON 格式，例如：
```
slug: Validation error: invalid_slug [{"value": String("TestCompany")}]
```

**建议**: 优化前端错误消息展示，转换为用户友好的文本，如「Slug 只能包含小写字母、数字和连字符」

---

## 检查清单

### 01-crud.md

| # | 场景 | 状态 | 测试日期 | 备注 |
|---|------|------|----------|------|
| 1 | 创建租户 | ✓ | 2026-02-02 | |
| 2 | 创建重复 Slug 租户 | ✓ | 2026-02-02 | |
| 3 | 更新租户信息 | ✓ | 2026-02-02 | |
| 4 | 删除无关联数据租户 | ⚠️ | 2026-02-02 | 软删除 |
| 5 | 删除有关联数据租户 | ⏭️ | | 无测试数据 |

### 02-list-settings.md

| # | 场景 | 状态 | 测试日期 | 备注 |
|---|------|------|----------|------|
| 1 | 租户列表分页 | ⏭️ | | 数据量不足 |
| 2 | 查看租户详情 | ⏭️ | | |
| 3 | 搜索租户 | ⏭️ | | |
| 4 | 租户设置更新 | ⏭️ | | |
| 5 | Slug 格式验证 | ✓ | 2026-02-02 | |
