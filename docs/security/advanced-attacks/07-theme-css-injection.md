# 高级攻击 - Theme CSS 注入与登录界面欺骗测试

**模块**: 高级攻击
**测试范围**: Keycloak Theme `custom_css` 注入、登录界面欺骗风险
**场景数**: 3
**风险等级**: 🔴 极高
**ASVS 5.0 矩阵ID**: M-ADV-07
**OWASP ASVS 5.0**: V3.1,V14.1,V15.2
**回归任务映射**: Backlog #7, #20

---

## 场景 1：`@import` 外链 CSS 注入
### 攻击目标
验证是否可通过 `custom_css` 引入外部样式资源影响登录页。
### 攻击步骤
1. 以管理员身份更新 branding `custom_css`，注入 `@import url(https://attacker.example/x.css);`。
2. 打开 Keycloak 登录页并抓包观察外连请求。
### 预期安全行为
- 外链 CSS 被拒绝或过滤。
- 登录页不应向未授权域名发起请求。

## 场景 2：输入框覆盖与伪装
### 攻击目标
验证 CSS 是否可遮挡真实输入框并引导到攻击者控制 UI。
### 攻击步骤
1. 注入覆盖样式（隐藏原密码框、显示伪造提示区）。
2. 使用普通用户访问登录页，检查视觉误导。
### 预期安全行为
- 不允许可改变安全关键交互的危险 CSS。

## 场景 3：安全提示与品牌信任链破坏
### 攻击目标
验证是否可通过 CSS 伪造安全提示、混淆域名/品牌归属。
### 攻击步骤
1. 注入伪造 `::before` 文案与警告样式。
2. 核对用户可见安全提示是否被篡改。
### 预期安全行为
- 关键安全提示不应被可配置 CSS 任意篡改。

---

## 标准化回归 Checklist（ASVS 5.0）

**矩阵ID**: M-ADV-07  
**适用控制**: V3.1,V14.1,V15.2  
**关联任务**: Backlog #7, #20  
**建议回归频率**: 每次发布前 + 缺陷修复后必跑  
**场景总数**: 3

### 执行清单
- [ ] M-ADV-07-C01 | 控制: V3.1 | 任务: #7, #20 | 动作: 执行文档内相关攻击步骤并记录证据
- [ ] M-ADV-07-C02 | 控制: V14.1 | 任务: #7, #20 | 动作: 执行文档内相关攻击步骤并记录证据
- [ ] M-ADV-07-C03 | 控制: V15.2 | 任务: #7, #20 | 动作: 执行文档内相关攻击步骤并记录证据

### 回归记录表
| 检查项ID | 执行结果(pass/fail) | 风险等级 | 证据（请求/响应/日志/截图） | 备注 |
|---|---|---|---|---|
|  |  |  |  |  |
