apiVersion: v1
kind: ConfigMap
metadata:
  name: auth9-config
  namespace: auth9
  labels:
    app.kubernetes.io/name: auth9
data:
  # Logging
  RUST_LOG: "info"
  
  # Server configuration
  HTTP_HOST: "0.0.0.0"
  HTTP_PORT: "8080"
  GRPC_HOST: "0.0.0.0"
  GRPC_PORT: "50051"
  
  # Database configuration
  DATABASE_MAX_CONNECTIONS: "10"
  DATABASE_MIN_CONNECTIONS: "2"
  
  # JWT configuration
  # IMPORTANT: JWT_ISSUER must be the Core API public URL (not portal URL)
  # This is used to build the OAuth callback URL: {JWT_ISSUER}/api/v1/auth/callback
  JWT_ISSUER: "https://api.auth9.example.com"
  JWT_ACCESS_TOKEN_TTL_SECS: "3600"
  JWT_REFRESH_TOKEN_TTL_SECS: "604800"
  
  # Keycloak configuration
  KEYCLOAK_REALM: "auth9"
  KEYCLOAK_ADMIN_CLIENT_ID: "auth9-admin"
  KEYCLOAK_SSL_REQUIRED: "none"
  # IMPORTANT: KEYCLOAK_PUBLIC_URL is the browser-accessible URL for Keycloak login
  # Must be exposed via cloudflared tunnel
  KEYCLOAK_PUBLIC_URL: "https://idp.auth9.example.com"
  
  # gRPC Security
  GRPC_AUTH_MODE: "api_key"
  GRPC_ENABLE_REFLECTION: "false"

  # WebAuthn configuration
  # WEBAUTHN_RP_ID must be an effective domain of AUTH9_PORTAL_URL
  WEBAUTHN_RP_ID: "auth9.example.com"

  # CORS
  CORS_ALLOWED_ORIGINS: "https://auth9.example.com"
  CORS_ALLOW_CREDENTIALS: "true"

  # Platform admin emails (comma-separated)
  PLATFORM_ADMIN_EMAILS: "admin@auth9.local"

  # Portal configuration
  AUTH9_CORE_URL: "http://auth9-core:8080"
  AUTH9_CORE_PUBLIC_URL: "https://api.auth9.example.com"
  AUTH9_PORTAL_URL: "https://auth9.example.com"
  AUTH9_PORTAL_CLIENT_ID: "auth9-portal"
  NODE_ENV: "production"

  # Telemetry / Observability
  OTEL_METRICS_ENABLED: "true"
  OTEL_TRACING_ENABLED: "true"
  OTEL_EXPORTER_OTLP_ENDPOINT: "http://tempo.observability:4317"
  LOG_FORMAT: "json"
  OTEL_SERVICE_NAME: "auth9-core"
