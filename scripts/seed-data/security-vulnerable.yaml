# Security Vulnerable Test Data Configuration
# 安全测试数据配置（包含已知弱配置，用于渗透测试）

# ⚠️ 警告：此文件包含故意设置的安全漏洞配置，仅用于安全测试
# 请勿在生产环境使用

# 租户配置
tenants:
  - id: "sec-tenant-weak"
    slug: "sec-weak-policy"
    name: "Security Test - Weak Password Policy"
    status: "active"
    password_policy:
      min_length: 1  # 极弱，用于测试
      require_uppercase: false
      require_lowercase: false
      require_number: false
      require_symbol: false
      lockout_threshold: 999  # 几乎不锁定
      lockout_duration_mins: 1
  
  - id: "sec-tenant-misconfigured"
    slug: "sec-misconfigured"
    name: "Security Test - Misconfigured Tenant"
    status: "active"
    password_policy:
      min_length: 8

# 用户配置（用于测试各种攻击向量）
users:
  # SQL 注入测试用户
  - username: "admin' OR '1'='1"
    email: "sqli-test@security.local"
    password: "SecTest123!"
    first_name: "SQL"
    last_name: "Injection"
    email_verified: true
    tenants:
      - tenant: "sec-weak-policy"
        role: "member"
  
  # XSS 测试用户
  - username: "xss-test"
    email: "xss-test@security.local"
    password: "SecTest123!"
    first_name: "<script>alert('XSS')</script>"
    last_name: "<img src=x onerror=alert('XSS')>"
    email_verified: true
    tenants:
      - tenant: "sec-weak-policy"
        role: "member"
  
  # 路径遍历测试用户
  - username: "../../etc/passwd"
    email: "path-traversal@security.local"
    password: "SecTest123!"
    first_name: "../../../"
    last_name: "Path"
    email_verified: true
    tenants:
      - tenant: "sec-weak-policy"
        role: "member"
  
  # 弱密码测试用户
  - username: "weak-password-user"
    email: "weak@security.local"
    password: "1"  # 极弱密码（在 weak-policy 租户中允许）
    first_name: "Weak"
    last_name: "Password"
    email_verified: true
    tenants:
      - tenant: "sec-weak-policy"
        role: "member"
  
  # 权限提升测试用户
  - username: "privilege-escalation"
    email: "privesc@security.local"
    password: "SecTest123!"
    first_name: "Privilege"
    last_name: "Escalation"
    email_verified: true
    tenants:
      - tenant: "sec-misconfigured"
        role: "member"

# 服务配置（包含不安全配置）
services:
  - slug: "sec-insecure-service"
    name: "Security Test - Insecure Service"
    tenant: "sec-weak-policy"
    description: "Service with weak security configurations"
  
  - slug: "sec-test-api"
    name: "Security Test API"
    tenant: "sec-misconfigured"
    description: "API for security testing"

# 客户端配置（故意不安全）
clients:
  # 公共客户端使用机密流程（不安全）
  - name: "Insecure Public Client"
    service: "sec-insecure-service"
    type: "public"
    redirect_uris:
      - "http://localhost:*"  # 通配符重定向（不安全）
      - "http://evil.com/callback"  # 恶意重定向
      - "http://localhost:3000/../evil"  # 路径遍历
    grants:
      - "authorization_code"
      - "implicit"  # 不推荐的 implicit flow
      - "password"  # Resource Owner Password Credentials（不安全）
  
  # 无重定向 URI 限制
  - name: "No Redirect Limit Client"
    service: "sec-insecure-service"
    type: "confidential"
    redirect_uris:
      - "*"  # 任意重定向（严重不安全）
    grants:
      - "authorization_code"
  
  # 暴露 client_secret 的客户端
  - name: "Exposed Secret Client"
    service: "sec-test-api"
    type: "confidential"
    client_secret: "weak_secret_123"  # 弱密钥（应该是强随机字符串）
    grants:
      - "client_credentials"

# 权限配置
permissions:
  - tenant: "sec-weak-policy"
    service: "sec-insecure-service"
    code: "admin:all"
    description: "All admin permissions"
  
  - tenant: "sec-weak-policy"
    service: "sec-insecure-service"
    code: "users:delete"
    description: "Delete users"
  
  - tenant: "sec-misconfigured"
    service: "sec-test-api"
    code: "data:read"
    description: "Read data"
  
  - tenant: "sec-misconfigured"
    service: "sec-test-api"
    code: "data:write"
    description: "Write data"

# 角色配置（包含循环继承等问题）
roles:
  # 循环继承测试
  - tenant: "sec-weak-policy"
    service: "sec-insecure-service"
    name: "Circular Role A"
    slug: "circular-a"
    parent: "circular-b"  # 指向下面的 circular-b
    permissions:
      - "users:delete"
  
  - tenant: "sec-weak-policy"
    service: "sec-insecure-service"
    name: "Circular Role B"
    slug: "circular-b"
    parent: "circular-a"  # 循环回 circular-a
    permissions:
      - "admin:all"
  
  # 孤儿角色（父角色不存在）
  - tenant: "sec-weak-policy"
    service: "sec-insecure-service"
    name: "Orphaned Role"
    slug: "orphaned"
    parent: "non-existent-role"  # 不存在的父角色
    permissions:
      - "admin:all"
  
  # 正常角色用于对比
  - tenant: "sec-misconfigured"
    service: "sec-test-api"
    name: "Normal User"
    slug: "normal-user"
    permissions:
      - "data:read"

# 用户角色分配（测试权限绕过）
user_roles:
  - user: "privesc@security.local"
    tenant: "sec-misconfigured"
    roles:
      - "normal-user"  # 普通用户，应测试是否能提升到 admin

# Webhook 配置（故意配置 SSRF 测试）
webhooks:
  # SSRF 测试 - AWS 元数据端点
  - tenant: "sec-weak-policy"
    url: "http://169.254.169.254/latest/meta-data/"
    secret: "weak"
    events:
      - "user.created"
    enabled: true
  
  # SSRF 测试 - 内网 Redis 访问
  - tenant: "sec-weak-policy"
    url: "http://localhost:6379"
    secret: "weak"
    events:
      - "user.created"
    enabled: true
  
  # SSRF 测试 - 内网数据库访问
  - tenant: "sec-weak-policy"
    url: "http://localhost:4000/admin"
    secret: "weak"
    events:
      - "user.created"
    enabled: true
  
  # URL 注入测试
  - tenant: "sec-misconfigured"
    url: "http://webhook.test.local/callback?admin=true&bypass=1"
    secret: "test_secret"
    events:
      - "user.created"
    enabled: false

# 邀请配置（测试边界场景）
invitations:
  # 永不过期的邀请（配置错误）
  - tenant: "sec-weak-policy"
    email: "never-expire@security.local"
    invited_by: "admin@sec-weak-policy.local"
    status: "pending"
    expires_in_days: 3650  # 10 年（不合理）
  
  # 邮箱注入测试
  - tenant: "sec-weak-policy"
    email: "test@evil.com%0d%0aBcc:attacker@evil.com"
    invited_by: "admin@sec-weak-policy.local"
    status: "pending"
    expires_in_days: 7

# 系统设置（不安全配置）
system_settings:
  # 邮件提供商配置泄露敏感信息
  - category: "email"
    key: "provider"
    value:
      type: "smtp"
      config:
        host: "smtp.insecure.local"
        port: 25  # 非加密端口
        username: "plaintext_user"
        password: "plaintext_password"  # 明文密码（不安全）
        encryption: "none"  # 无加密
  
  # 允许注册且无验证
  - category: "branding"
    key: "login_page"
    value:
      allow_registration: true
      require_email_verification: false  # 不验证邮箱（不安全）
      logo_url: "http://evil.com/logo.png?steal_token=yes"

# 测试注释
# 此配置文件用于以下安全测试场景：
# 1. SQL 注入攻击（用户名、搜索字段）
# 2. XSS 攻击（用户显示名称）
# 3. 路径遍历攻击（用户名、重定向 URI）
# 4. SSRF 攻击（Webhook URL）
# 5. 权限提升攻击（角色继承、权限分配）
# 6. 弱密码策略绕过
# 7. 客户端配置错误（redirect_uri 通配符）
# 8. 敏感信息泄露（明文密码、密钥）
